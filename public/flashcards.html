<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>Formula Flip Cards</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600;700&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded"/>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\$$', '\$$']], displayMath: [['$$', '$$'], ['\$$', '\$$']] },
            svg: { fontCache: "global" }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <section id="game">
        <header id="gameHeader" style="text-align:center;margin-bottom:20px;">
            <h1 id="gameTitle">Formula Flip Cards</h1>
            <p id="gameSubtitle" class="subtitle">Press space / swipe to navigate</p>
        </header>

        <div class="flashcard-container glass">
            <div class="flashcard" id="flashCard">
                <div class="front" id="flashFront"></div>
                <div class="back"  id="flashBack"></div>
            </div>
        </div>

        <div class="progress"><div id="progressBar"></div></div>

        <div class="controls">
            <button class="btn" id="btnPrev"><span class="material-symbols-rounded">chevron_left</span></button>
            <button class="btn primary" id="btnFlip">Flip</button>
            <button class="btn" id="btnNext"><span class="material-symbols-rounded">chevron_right</span></button>
            <button class="btn" id="btnShuffle"><span class="material-symbols-rounded">shuffle</span></button>
            <button class="btn" id="btnHome" onclick="window.location.href='index.html'"><span class="material-symbols-rounded">home</span></button>
        </div>
        <div class="counter" id="gameCounter"></div>
    </section>

    <script type="module">
        async function loadData() {
            const response = await fetch('/data/flashcard.json');
            return await response.json();
        }

        async function init() {
            const deck = await loadData();
            let flashIdx = 0;
            
            function renderFlash() {
                const card = deck[flashIdx];
                document.getElementById('flashFront').innerHTML = `<div style="font-size:1.35rem;font-weight:600;">${card.front}</div>`;
                document.getElementById('flashBack').innerHTML = `<div style="font-size:0.95rem;line-height:1.4;">${card.back}</div>`;
                document.getElementById('gameCounter').textContent = `Card ${flashIdx+1} / ${deck.length}`;
                document.getElementById('progressBar').style.width = ((flashIdx+1)/deck.length*100)+'%';
                setTimeout(() => window.MathJax.typeset(), 0);
            }
            
            document.getElementById('btnNext').onclick = () => {
                flashIdx = (flashIdx+1) % deck.length;
                renderFlash();
            };
            
            document.getElementById('btnPrev').onclick = () => {
                flashIdx = (flashIdx-1+deck.length) % deck.length;
                renderFlash();
            };
            
            document.getElementById('btnFlip').onclick = () => {
                document.getElementById('flashCard').classList.toggle('flipped');
            };
            
            document.getElementById('btnShuffle').onclick = () => {
                for(let i=deck.length-1; i>0; i--) {
                    const j = Math.floor(Math.random()*(i+1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
                flashIdx = 0;
                renderFlash();
            };
            
            document.getElementById('flashCard').onclick = () => {
                document.getElementById('flashCard').classList.toggle('flipped');
            };
            
            renderFlash();
        }

        init();
    </script>
</body>
</html>